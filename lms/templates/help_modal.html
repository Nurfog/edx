<%page expression_filter="h"/>
<%namespace name='static' file='static_content.html'/>

<%!
from datetime import datetime
import pytz
from django.conf import settings
from django.utils.translation import ugettext as _
from django.core.urlresolvers import reverse
from openedx.core.djangolib.js_utils import js_escaped_string
from openedx.core.djangolib.markup import HTML, Text
from xmodule.tabs import CourseTabList
%>

% if settings.FEATURES.get('ENABLE_FEEDBACK_SUBMISSION', False):

<div class="help-tab hidden-mobile">
  <a href="#help-modal" rel="leanModal" role="button">${_("Support")}</a>
</div>

<div id="help-modal" class="modal" aria-hidden="true" role="dialog" aria-modal="true" tabindex="-1" aria-labelledby="support-platform-name">
  <div class="inner-wrapper">
    ## TODO: find a way to refactor this
    <button class="btn-link close-modal" tabindex="0">
      <span class="icon fa fa-remove" aria-hidden="true"></span>
      <span class="sr">
        ## Translators: this is a control to allow users to exit out of this modal interface (a menu or piece of UI that takes the full focus of the screen)
        ${_('Close')}
      </span>
    </button>
    <div id="help_wrapper">

        <header>
          <h2 id="support-platform-name">
        ${Text(_('{platform_name} Support')).format(
            platform_name=HTML(u'<span class="edx">{}</span>').format(static.get_platform_name())
        )}
          </h2>
          <hr>
        </header>

    <%
      discussion_tab = CourseTabList.get_discussion(course) if course else None
      discussion_link = discussion_tab.link_func(course, reverse) if (discussion_tab and discussion_tab.is_enabled(course, user=user)) else None
    %>

    % if discussion_link:
        <p>${Text(_('For {strong_start}questions on course lectures, homework, tools, or materials for this course{strong_end}, post in the {link_start}course discussion forum{link_end}.')).format(
          strong_start=HTML('<strong>'),
          strong_end=HTML('</strong>'),
          link_start=HTML('<a href="{url}" target="_blank">').format(
            url=discussion_link
          ),
          link_end=HTML('</a>'),
          )}
        </p>
    % endif

        <p>${Text(_('Have {strong_start}general questions about {platform_name}{strong_end}? You can find lots of helpful information in the {platform_name} {link_start}FAQ{link_end}.')).format(
            strong_start=HTML('<strong>'),
            strong_end=HTML('</strong>'),
            link_start=HTML('<a href="{url}" id="feedback-faq-link" target="_blank">').format(
              url=marketing_link('FAQ')
            ),
            link_end=HTML('</a>'),
            platform_name=static.get_platform_name())}
          </p>

        <p>${Text(_('Have a {strong_start}question about something specific{strong_end}? You can contact the {platform_name} general support team directly:')).format(
            strong_start=HTML('<strong>'),
            strong_end=HTML('</strong>'),
            platform_name=static.get_platform_name()
          )}</p>
        <hr>

        <div class="help-buttons">
            <a type="button" class="btn btn-primary" id="support-form-link" href="${reverse('support:contact_us')}">${_('Contact Us')}</a>
        </div>

        <p class="note">${_('Please note: The {platform_name} support team is English speaking. While we will do our best to address your inquiry in any language, our responses will be in English.').format(
            platform_name=static.get_platform_name()
        )}</p>

    </div>
  </div>
</div>

<script type="text/javascript">
$(document).ready(function() {
    var $helpModal = $("#help-modal"),
        $closeButton = $("#help-modal .close-modal"),
        $leanOverlay = $("#lean_overlay"),
        onModalClose = function() {
            $closeButton.off("click");
            $leanOverlay.off("click");
            $helpModal.attr("aria-hidden", "true");
            $('area,input,select,textarea,button').removeAttr('tabindex');
            $(".help-tab a").focus();
            $leanOverlay.removeAttr('tabindex');
        };

    DialogTabControls.setKeydownListener($helpModal, $closeButton);

    $(".help-tab").click(function() {
        $helpModal.css("position", "absolute");
        DialogTabControls.initializeTabKeyValues("#help_wrapper", $closeButton);
        $("#help_wrapper").css("display", "block");
        $helpModal.attr("aria-hidden", "false");
        $closeButton.click(onModalClose);
        $leanOverlay.click(onModalClose);
        $("button.close-modal").attr('tabindex', 0);
        $closeButton.focus();
    });
});
</script>

%endif
