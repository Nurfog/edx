<%! from django.utils.translation import ugettext as _ %>
<%! from django.template.defaultfilters import escapejs %>

<script aria-hidden="true" type="text/template" id="thread-list-item-template">
  <li data-id="${'<%- id %>'}" class="forum-nav-thread${'<% if (typeof(read) != "undefined" && !read) { %> is-unread<% } %>'}">
    <a href="#" class="forum-nav-thread-link">
      <div class="forum-nav-thread-wrapper-0">
        ${u"""<%
        var icon_class, sr_text;
        if (thread_type == "discussion") {{
            icon_class = "fa-comments";
            sr_text = "{discussion}";
        }} else if (endorsed) {{
            icon_class = "fa-check-square-o";
            sr_text = "{answered_question}";
        }} else {{
            icon_class = "fa-question";
            sr_text = "{unanswered_question}";
        }}
        %>""".format(
            ## Translators: This is a label for a Discussion forum thread
            discussion=escapejs(_("discussion")),
            ## Translators: This is a label for a Question forum thread with a marked answer
            answered_question=escapejs(_("answered question")),
            ## Translators: This is a label for a Question forum thread without a marked answer
            unanswered_question=escapejs(_("unanswered question"))
        )}
        <span class="sr">${"<%= sr_text %>"}</span>
        <i class="icon fa ${"<%= icon_class %>"}"></i>
      </div><div class="forum-nav-thread-wrapper-1">
        <span class="forum-nav-thread-title">${"<%- title %>"}</span>
        <%
        js_block = u"""
        var labels = "";
        if (pinned) {{
            labels += '<li class="post-label-pinned"><i class="icon fa fa-thumb-tack"></i>{pinned_text}</li> ';
        }}
        if (typeof(subscribed) != "undefined" && subscribed) {{
            labels += '<li class="post-label-following"><i class="icon fa fa-star"></i>{following_text}</li> ';
        }}
        if (staff_authored) {{
            labels += '<li class="post-label-by-staff"><i class="icon fa fa-user"></i>{staff_text}</li> ';
        }}
        if (community_ta_authored) {{
            labels += '<li class="post-label-by-community-ta"><i class="icon fa fa-user"></i>{community_ta_text}</li> ';
        }}
        if (labels != "") {{
            print('<ul class="forum-nav-thread-labels">' + labels + '</ul>');
        }}
        """.format(
            ## Translators: This is a label for a forum thread that has been pinned
            pinned_text=escapejs(_("Pinned")),
            ## Translators: This is a label for a forum thread that the user is subscribed to
            following_text=escapejs(_("Following")),
            ## Translators: This is a label for a forum thread that was authored by a member of the course staff
            staff_text=escapejs(_("By: Staff")),
            ## Translators: This is a label for a forum thread that was authored by a community TA
            community_ta_text=escapejs(_("By: Community TA"))
        )
         %>
        ${"<%"}${js_block}${"%>"}
      </div><div class="forum-nav-thread-wrapper-2">
        <%
        js_block = u"""
            interpolate(
                '{}',
                {{'span_sr_open': '<span class=\"sr\">', 'span_close': '</span>', 'votes_up_count': votes['up_count']}},
                true
                )
        """.format(
                ## Translators: 'votes_up_count' is a numerical placeholder for a specific discussion thread; 'span_*' placeholders refer to HTML markup.  Please translate the word 'votes'.
                escapejs( _('%(votes_up_count)s%(span_sr_open)s votes %(span_close)s'))
            )
        %>
        <span class="forum-nav-thread-votes-count">+${'<%='}${js_block}${'%>'}</span>
        <%
        js_block =  u"""
        var fmt;
        // Counts in data do not include the post itself, but the UI should
        var data = {{
            'span_sr_open': '<span class=\"sr\">',
            'span_close': '</span>',
            'unread_comments_count': unread_comments_count + (read ? 0 : 1),
            'comments_count': comments_count + 1
            }};
        if (unread_comments_count > 0) {{
            fmt = '{markup_with_unread}';
        }} else {{
            fmt = '{markup_none_unread}';
        }}
        print(interpolate(fmt, data, true));
        """.format(
                ## Translators: 'comments_count' and 'unread_comments_count' are numerical placeholders for a specific discussion thread; 'span_*' placeholders refer to HTML markup.  Please translate the word 'comments'.
                markup_with_unread=escapejs(_('%(comments_count)s %(span_sr_open)scomments (%(unread_comments_count)s unread comments)%(span_close)s')),
                ## Translators: 'comments_count' is a numerical placeholder for a specific discussion thread; 'span_*' placeholders refer to HTML markup.  Please translate the word 'comments'.
                markup_none_unread=escapejs(_('%(comments_count)s %(span_sr_open)scomments %(span_close)s'))
            )
        %>
        <span class="forum-nav-thread-comments-count ${'<% if (unread_comments_count > 0) { %>is-unread<% } %>'}">
            ${'<%'}${js_block}${'%>'}
        </span>
      </div>
    </a>
  </li>
</script>

<script aria-hidden="true" type="text/template" id="discussion-home">
  <div class="discussion-article blank-slate">
    <section class="home-header">
      <span class="label">${_("DISCUSSION HOME:")}</span>
      % if course and course.display_name_with_default:
        <h1 class="home-title">${course.display_name_with_default}</h1>
      % endif
    </section>

      % if settings.FEATURES.get('ENABLE_DISCUSSION_HOME_PANEL'):
        <span class="label label-settings">
          ${_("How to use {platform_name} discussions").format(platform_name=settings.PLATFORM_NAME)}
        </span>
        <table class="home-helpgrid">
          <tr class="helpgrid-row helpgrid-row-navigation">
            <td class="row-title">${_("Find discussions")}</td>
            <td class="row-item">
              <i class="icon fa fa-reorder"></i>
              <span class="row-description">${_("Focus in on specific topics")}</span>
            </td>
            <td class="row-item">
              <i class="icon fa fa-search"></i>
              <span class="row-description">${_("Search for specific posts ")}</span>
            </td>
            <td class="row-item">
              <i class="icon fa fa-sort"></i>
              <span class="row-description">${_("Sort by date, vote, or comments")}</span>
            </td>
          </tr>
          <tr class="helpgrid-row helpgrid-row-participation">
            <td class="row-title">${_("Engage with posts")}</td>
            <td class="row-item">
              <i class="icon fa fa-plus"></i>
              <span class="row-description">${_("Upvote posts and good responses")}</span>
            </td>
            <td class="row-item">
              <i class="icon fa fa-flag"></i>
              <span class="row-description">${_("Report Forum Misuse")}</span>
            </td>
            <td class="row-item">
              <i class="icon fa fa-star"></i>
              <span class="row-description">${_("Follow posts for updates")}</span>
            </td>
          </tr>
          <tr class="helpgrid-row helpgrid-row-notification">
            <td class="row-title">${_('Receive updates')}</td>
            <td class="row-item-full" colspan="3">
              <label for="email-setting-checkbox">
                <span class="sr">${_("Toggle Notifications Setting")}</span>
                <span class="notification-checkbox">
                  <input type="checkbox" id="email-setting-checkbox" class="email-setting" name="email-notification"/>
                  <i class="icon fa fa-envelope"></i>
                </span>
              </label>
              <span class="row-description">${_("Check this box to receive an email digest once a day notifying you about new, unread activity from posts you are following.")}</span>
            </td>
          </tr>
        </table>
      % endif
     </div>
</script>