tinymce.PluginManager.requireLangPack("codemirror"),tinymce.PluginManager.add("codemirror",function(e,y){function i(){e.focus(),e.selection.collapse(!0),e.settings.codemirror.saveCursorPosition&&e.selection.setContent('<span style="display: none;" class="CmCaReT">&#x0;</span>');var c,l=tinyMCE.baseURL.indexOf("/static/");l>0?c=tinyMCE.baseURL.substring(0,l):c=window.location.origin;var p="?CodeMirrorPath="+e.settings.codemirror.path+"&ParentOrigin="+window.location.origin,m=800;e.settings.codemirror.width&&(m=e.settings.codemirror.width);var d=550;e.settings.codemirror.height&&(d=e.settings.codemirror.height);var w=tinymce.majorVersion<5?[{text:"Ok",subtype:"primary",onclick:function(){var o=document.querySelectorAll(".mce-container-body>iframe")[0];o.contentWindow.submit(),t.close()}},{text:"Cancel",onclick:"close"}]:[{type:"custom",text:"Ok",name:"codemirrorOk",primary:!0},{type:"cancel",text:"Cancel",name:"codemirrorCancel"}],s={title:"HTML source code",url:y+"/source.html"+p,width:m,height:d,resizable:!0,maximizable:!0,fullScreen:e.settings.codemirror.fullscreen,saveCursorPosition:!1,buttons:w,onClose:function(){window.removeEventListener("message",u)}};tinymce.majorVersion>=5&&(s.onAction=function(o,n){n.name==="codemirrorOk"?a({type:"save"}):n.name==="codemirrorCancel"&&(a({type:"cancel"}),t.close())});var t=tinymce.majorVersion<5?e.windowManager.open(s):e.windowManager.openUrl(s),a=function(o){t.sendMessage(o)},u=function(o){if(c===o.origin){var n;if(o.data.type==="init")n={content:e.getContent({source_view:!0})},e.fire("ShowCodeEditor",n),a({type:"init",content:n.content}),e.dom.remove(e.dom.select(".CmCaReT"));else if(o.data.type==="setText"){n={content:o.data.text};var g=o.data.isDirty;e.fire("SaveCodeEditor",n),e.setContent(n.content);var r=e.dom.select("span#CmCaReT")[0];if(r)e.selection.scrollIntoView(r),e.selection.setCursorLocation(r,0),e.dom.remove(r);else{var f=e.getContent(),C=f.replace('<span id="CmCaReT"></span>',"");f!==C&&e.setContent(C)}e.isNotDirty=!g,g&&e.nodeChanged(),e.undoManager.add(),t.close()}else o.data.type==="closeWindow"&&t.close()}};window.addEventListener("message",u,!1)}tinymce.majorVersion<5?(e.addButton("code",{title:"Source code",icon:"code",onclick:i}),e.addMenuItem("code",{icon:"code",text:"Source code",context:"tools",onclick:i})):(e.ui.registry.addButton("code",{text:"HTML",tooltip:"Edit HTML",onAction:i}),e.ui.registry.addMenuItem("code",{icon:"sourcecode",text:"Edit HTML",onAction:i,context:"tools"}))});
